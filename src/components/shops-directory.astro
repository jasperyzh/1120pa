---
import shops from "../content/shops.json";

// Get unique categories for filter if we had them in JSON, but for now hardcode or infer?
// The JSON doesn't have categories, so I will add a category based on the name or just add "Category" to the display for now.
// Wait, the prompt asked for filtering: [All] [Food] [Services] [Groceries].
// I'll assume some derived categories for the demo or just map everything to 'Services' if not specified,
// OR I will update the shops.json in my mind to include categories?
// The user said: "Business Name & Category" in the plan.
// I will just add a 'category' field to the JSON logic or inferred.
// Actually, let's keep it simple and just show all for now, BUT add the UI for filtering and make it functional
// by adding data attributes. I will mock the category logic for existing 2 items.
// "Bubble Laundry" -> Services
// "The Condo Cafe" -> Food

const shopsWithCategory = shops.map((shop) => {
    let category = "Services";
    if (
        shop.name.toLowerCase().includes("cafe") ||
        shop.name.toLowerCase().includes("food")
    ) {
        category = "Food";
    } else if (
        shop.name.toLowerCase().includes("mart") ||
        shop.name.toLowerCase().includes("grocer")
    ) {
        category = "Groceries";
    }
    return { ...shop, category };
});

const categories = ["All", "Food", "Services", "Groceries"];
---

<div class="mb-4">
    <div class="d-flex justify-content-center gap-2 mb-4" id="filters">
        {
            categories.map((cat) => (
                <button
                    class="btn btn-outline-primary filter-btn"
                    data-filter={cat}
                >
                    {cat}
                </button>
            ))
        }
    </div>

    <div
        class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"
        id="shops-container"
    >
        {
            shopsWithCategory.map((shop) => (
                <div class="col shop-item" data-category={shop.category}>
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">
                                {shop.name}{" "}
                                <span class="badge bg-secondary fs-6">
                                    {shop.category}
                                </span>
                            </h5>
                            <p class="card-text mb-1">üìç {shop.location}</p>
                            <p class="card-text mb-1">
                                <small class="text-body-secondary">
                                    ‚è∞ {shop.hours}
                                </small>
                            </p>

                            <div class="mt-3 d-flex justify-content-between align-items-center">
                                <a
                                    href={`https://wa.me/${shop.contact}`}
                                    class="btn btn-success btn-sm"
                                    target="_blank"
                                >
                                    <i class="bi bi-whatsapp" /> WhatsApp
                                </a>
                                {shop.delivery && (
                                    <span class="badge text-bg-info">
                                        Delivery
                                    </span>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            ))
        }
    </div>
</div>

<script>
    const filterBtns = document.querySelectorAll(".filter-btn");
    const shopItems = document.querySelectorAll(".shop-item");

    filterBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            // Remove active class from all
            filterBtns.forEach((b) =>
                b.classList.remove("active", "btn-primary"),
            );
            filterBtns.forEach((b) => b.classList.add("btn-outline-primary"));

            // Add active to clicked
            btn.classList.remove("btn-outline-primary");
            btn.classList.add("active", "btn-primary");

            const filterValue = btn.getAttribute("data-filter");

            shopItems.forEach((item) => {
                // Cast to HTMLElement to access dataset safely
                const itemEl = item as HTMLElement;
                if (
                    filterValue === "All" ||
                    itemEl.dataset.category === filterValue
                ) {
                    itemEl.style.display = "block";
                } else {
                    itemEl.style.display = "none";
                }
            });
        });
    });

    // Set 'All' as active by default
    const allBtn = document.querySelector('[data-filter="All"]');
    if (allBtn) {
        allBtn.classList.remove("btn-outline-primary");
        allBtn.classList.add("active", "btn-primary");
    }
</script>
